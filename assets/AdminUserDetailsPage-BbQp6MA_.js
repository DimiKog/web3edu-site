import{d as S,r,j as e}from"./vendor-react-XZtyZRd7.js";import{A as C}from"./AdminBackButton-BZVMxydf.js";import{u as $}from"./vendor-web3-Dys35WFk.js";const w="https://web3edu-api.dimikog.org";function F(){const{address:n}=$(),{wallet:c}=S(),a=decodeURIComponent(c||""),[h,d]=r.useState(!0),[i,x]=r.useState(null),[t,b]=r.useState(null);r.useEffect(()=>{const s=localStorage.getItem("adminWallet")||localStorage.getItem("web3edu-wallet-address")||localStorage.getItem("walletAddress")||localStorage.getItem("wallet")||n;if(!s||!a){x("Missing wallet context."),d(!1);return}let l=!0;async function A(){try{const f=await fetch(`${w}/admin/users/details?wallet=${s}&user=${a}`);if(f.ok){const p=await f.json();l&&(b(p),x(null),d(!1));return}const g=await fetch(`${w}/admin/users?wallet=${s}`);if(!g.ok)throw new Error("Failed to fetch user details");const m=await g.json(),N=(Array.isArray(m)?m:Array.isArray(m?.users)?m.users:[]).find(p=>String(p?.wallet||p?.address||"").toLowerCase()===String(a).toLowerCase());if(!N)throw new Error("User not found");l&&(b({user:N}),x(null),d(!1))}catch{l&&(x("Could not load user details."),d(!1))}}return A(),()=>{l=!1}},[n,a]);const k=r.useMemo(()=>t?.labsCompleted?t.labsCompleted:[],[t]),v=r.useMemo(()=>t?.labsStartedNotCompleted?t.labsStartedNotCompleted:[],[t]),o=r.useMemo(()=>t?.xpBreakdown||null,[t]),j=r.useMemo(()=>t?.timeline?t.timeline.map(s=>({label:s?.title?.en||s?.id||s?.type||"Activity",when:s?.completedAt||"—",xp:s?.xp??null})):[],[t]);return h?e.jsx("div",{className:"max-w-4xl rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl px-6 py-4 text-slate-700 dark:text-slate-200",children:"Loading user details…"}):i?e.jsx("div",{className:"max-w-4xl rounded-2xl border border-red-500/30 bg-red-500/10 text-red-200 px-6 py-4",children:i}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-extrabold tracking-tight bg-gradient-to-r from-[#FF67D2] via-[#8A57FF] to-[#4ACBFF] text-transparent bg-clip-text",children:"User Analytics"}),t?.user&&e.jsxs("p",{className:"mt-1 text-sm text-slate-600 dark:text-slate-300",children:["Tier: ",e.jsx("span",{className:"font-semibold",children:t.user.tier})," · XP:"," ",e.jsx("span",{className:"font-semibold",children:t.user.xp})]}),e.jsx("p",{className:"mt-2 font-mono text-xs text-slate-600 dark:text-slate-300 break-all",children:a})]}),e.jsx(C,{to:"/admin/users",label:"Back to Users"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u,{title:"Labs Completed List",children:e.jsx(y,{items:k,emptyMessage:"No completed labs available."})}),e.jsx(u,{title:"Labs Started but Not Completed",children:e.jsx(y,{items:v,emptyMessage:"No incomplete labs available."})}),e.jsx(u,{title:"XP Breakdown",children:o?e.jsxs("div",{className:"space-y-4 text-sm",children:[o.labs?.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"Labs"}),e.jsx("ul",{className:"space-y-1",children:o.labs.map((s,l)=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:s.labId}),e.jsxs("span",{className:"font-medium",children:[s.xp," XP"]})]},`lab-${l}`))})]}),o.lessons?.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"Lessons"}),e.jsx("ul",{className:"space-y-1",children:o.lessons.map((s,l)=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:s.lessonId||"Lesson"}),e.jsxs("span",{className:"font-medium",children:[s.xp," XP"]})]},`lesson-${l}`))})]}),o.projects?.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"Projects"}),e.jsx("ul",{className:"space-y-1",children:o.projects.map((s,l)=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:s.projectId}),e.jsx("span",{className:"font-medium",children:"Completed"})]},`project-${l}`))})]})]}):e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No XP breakdown available."})}),e.jsx(u,{title:"Timeline of Activity",children:j.length?e.jsx("div",{className:"space-y-2",children:j.map((s,l)=>e.jsxs("div",{className:"rounded-lg border border-white/10 bg-white/60 dark:bg-slate-900/40 px-3 py-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:s.label}),s.xp!==null&&e.jsxs("p",{className:"text-xs font-medium text-emerald-400",children:[s.xp," XP"]})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:s.when})]},`${s.label}-${l}`))}):e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No timeline entries available."})})]})]})}function u({title:n,children:c}){return e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl shadow-[0_24px_70px_rgba(15,23,42,0.18)] p-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-3",children:n}),c]})}function y({items:n,emptyMessage:c}){return n.length?e.jsx("ul",{className:"space-y-2",children:n.map((a,h)=>{const d=a?.title?.en||a?.labId||a?.projectId||String(a),i=a?.completedAt||a?.startedAt||a?.xp;return e.jsx("li",{className:"rounded-lg border border-white/10 bg-white/60 dark:bg-slate-900/40 px-3 py-2 text-sm text-slate-800 dark:text-slate-200",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:d}),i&&e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:typeof i=="number"?`${i} XP`:i})]})},`${d}-${h}`)})}):e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:c})}export{F as default};
