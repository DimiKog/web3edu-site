import{j as e,u as A,r as u}from"./vendor-react-XZtyZRd7.js";import{f as R,a as F}from"./adminApi-CSNMpv-F.js";import{u as U}from"./vendor-web3-Dys35WFk.js";function D({overview:t,platform:s,onCardClick:r}){return e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(k,{id:"totalUsers",label:"Total Users",value:t?.totalUsers,delta:"7d delta: —",onClick:r}),e.jsx(k,{id:"startedAnyLab",label:"Started Any Lab",value:s?.usersStartedAnyLab??0,delta:"7d delta: —",onClick:r}),e.jsx(k,{id:"completedAnyLab",label:"Completed Any Lab",value:s?.usersCompletedAnyLab??0,delta:"7d delta: —",onClick:r}),e.jsx(k,{id:"retention3plus",label:"3+ Labs (Retention)",value:t?.usersWith3PlusLabs,delta:"7d delta: —",onClick:r})]})}function k({id:t,label:s,value:r,delta:p,onClick:n}){return e.jsxs("button",{type:"button",onClick:()=>n?.(t),className:"text-left rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl p-4 shadow-md hover:bg-white/90 dark:hover:bg-[#0f1420] transition",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400",children:s}),e.jsx("div",{className:"text-2xl font-semibold text-slate-900 dark:text-slate-100 mt-1",children:r}),e.jsx("div",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:p})]})}function B({platform:t}){if(!t)return null;const s=t.usersStartedAnyLab>0?Math.round(t.usersCompletedAnyLab/t.usersStartedAnyLab*100):0;return e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl shadow-[0_24px_70px_rgba(15,23,42,0.18)] p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-slate-900 dark:text-slate-100",children:"Platform Analytics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(j,{label:"Started Any Lab",value:t.usersStartedAnyLab}),e.jsx(j,{label:"Completed Any Lab",value:t.usersCompletedAnyLab}),e.jsx(j,{label:"Completion (Started → Completed)",value:`${s}%`})]})]})}function j({label:t,value:s}){return e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl p-4 shadow-md",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400",children:t}),e.jsx("div",{className:"text-2xl font-semibold text-slate-900 dark:text-slate-100 mt-1",children:s})]})}function _({labs:t}){const s=A();if(!t||t.length===0)return null;const r=[...t].sort((x,m)=>m.completionRate-x.completionRate),p=[...t].sort((x,m)=>m.dropOff-x.dropOff),n=[...t].sort((x,m)=>m.started-x.started),i=r[0],d=r[r.length-1],c=p[0],o=n[0],b=n[n.length-1];return e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl shadow-[0_24px_70px_rgba(15,23,42,0.18)] p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-slate-900 dark:text-slate-100",children:"Learning Insights"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsx(f,{label:"Best Performing Lab",value:`${i?.title?.en||i?.labId} (${Math.round(i?.completionRate*100)}%)`,onClick:()=>s(i?.labId?`/admin/labs/${i.labId}`:"/admin/labs")}),e.jsx(f,{label:"Lowest Completion",value:`${d?.title?.en||d?.labId} (${Math.round(d?.completionRate*100)}%)`,onClick:()=>s(d?.labId?`/admin/labs/${d.labId}`:"/admin/labs")}),e.jsx(f,{label:"Highest Drop-off",value:`${c?.title?.en||c?.labId} (${c?.dropOff})`,onClick:()=>s(c?.labId?`/admin/labs/${c.labId}`:"/admin/labs")}),e.jsx(f,{label:"Most Engaged Lab",value:`${o?.title?.en||o?.labId} (${o?.started} starts)`,onClick:()=>s(o?.labId?`/admin/labs/${o.labId}`:"/admin/labs")}),e.jsx(f,{label:"Lowest Engagement",value:`${b?.title?.en||b?.labId} (${b?.started} starts)`,onClick:()=>s(b?.labId?`/admin/labs/${b.labId}`:"/admin/labs")})]})]})}function f({label:t,value:s,onClick:r}){return e.jsxs("button",{type:"button",onClick:r,className:"text-left rounded-xl border border-white/10 bg-white/60 dark:bg-[#111827]/60 p-4 hover:bg-white/80 dark:hover:bg-[#111827]/80 transition",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400",children:t}),e.jsx("div",{className:"mt-1 font-medium text-slate-900 dark:text-slate-100",children:s})]})}function T(){const t=A(),{address:s}=U(),[r,p]=u.useState(null),[n,i]=u.useState(null),[d,c]=u.useState(null),[o,b]=u.useState(null),[x,m]=u.useState(null),[I,N]=u.useState(0),h=s?`admin-dashboard-cache:${s.toLowerCase()}`:null,L=u.useCallback(()=>{s&&Promise.all([R(s),F(s)]).then(([a,l])=>{p(a),b(l?.platform||null),c(l?.labs||[]),i(null);const C=new Date;m(C),h&&sessionStorage.setItem(h,JSON.stringify({overview:a,platform:l?.platform||null,labs:l?.labs||[],lastUpdatedIso:C.toISOString()}))}).catch(()=>{i("Could not load dashboard analytics.")})},[s,h]);if(u.useEffect(()=>{if(s){if(h)try{const a=sessionStorage.getItem(h);if(a){const l=JSON.parse(a);l?.overview&&(p(l.overview),b(l.platform||null),c(l.labs||[]),m(l.lastUpdatedIso?new Date(l.lastUpdatedIso):null))}}catch{}L()}},[s,h,L,I]),n)return e.jsxs("div",{className:"max-w-4xl rounded-2xl border border-red-500/30 bg-red-500/10 text-red-200 px-6 py-4 space-y-3",children:[e.jsx("div",{children:n}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>N(a=>a+1),className:"rounded-lg border border-red-300/40 bg-red-500/20 px-3 py-1.5 text-sm",children:"Retry"}),e.jsx("button",{type:"button",onClick:()=>t("/admin/labs"),className:"rounded-lg border border-red-300/40 bg-red-500/20 px-3 py-1.5 text-sm",children:"Open Labs"})]})]});if(!r)return e.jsx("div",{className:"max-w-4xl rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl px-6 py-4 text-slate-700 dark:text-slate-200",children:"Loading admin data…"});const S=[...d||[]].sort((a,l)=>(a?.completionRate||0)-(l?.completionRate||0)),$=[...d||[]].sort((a,l)=>(l?.dropOff||0)-(a?.dropOff||0)),g=S[0],v=$[0],O=Math.max(0,(o?.usersStartedAnyLab||0)-(o?.usersCompletedAnyLab||0));return e.jsxs("div",{className:"relative min-h-[calc(100vh-8rem)]",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[e.jsx("div",{className:"absolute -top-32 left-1/2 h-[420px] w-[420px] -translate-x-1/2 rounded-full bg-[#8A57FF]/25 blur-[140px]"}),e.jsx("div",{className:"absolute top-1/3 -right-24 h-[360px] w-[360px] rounded-full bg-[#4ACBFF]/20 blur-[140px]"}),e.jsx("div",{className:"absolute bottom-[-10%] left-[-8%] h-[320px] w-[320px] rounded-full bg-[#FF67D2]/15 blur-[130px]"})]}),e.jsxs("div",{className:"relative z-10 space-y-12",children:[e.jsxs("div",{className:"flex flex-col gap-6 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold tracking-tight bg-gradient-to-r from-[#FF67D2] via-[#8A57FF] to-[#4ACBFF] text-transparent bg-clip-text",children:"Admin Dashboard"}),e.jsx("p",{className:"text-base text-slate-600 dark:text-slate-300 mt-2",children:"Overview & management tools for Web3Edu"}),e.jsxs("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:["Last updated: ",x?x.toLocaleString():"—"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(w,{label:"View Labs",onClick:()=>t("/admin/labs")}),e.jsx(w,{label:"View Users",onClick:()=>t("/admin/users")}),e.jsx(w,{label:"Refresh",onClick:()=>N(a=>a+1)})]})]}),e.jsx(D,{overview:r,platform:o,onCardClick:a=>{a==="totalUsers"&&t("/admin/users?sort=xp&dir=desc"),a==="startedAnyLab"&&t("/admin/labs?sort=started"),a==="completedAnyLab"&&t("/admin/labs?sort=completion"),a==="retention3plus"&&t("/admin/users?sort=completed&dir=desc")}}),e.jsxs("div",{className:"rounded-2xl border border-rose-400/30 bg-rose-50/70 dark:bg-rose-900/10 backdrop-blur-xl shadow-[0_24px_70px_rgba(15,23,42,0.18)] p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-slate-900 dark:text-slate-100",children:"Top Risks"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(y,{label:"Highest Drop-off Lab",value:v?`${v?.title?.en||v?.labId} (${v?.dropOff||0})`:"—",onClick:()=>t("/admin/labs?sort=dropoff&risk=dropoff")}),e.jsx(y,{label:"Lowest Completion Lab",value:g?`${g?.title?.en||g?.labId} (${Math.round((g?.completionRate||0)*100)}%)`:"—",onClick:()=>t("/admin/labs?sort=completion&dir=asc")}),e.jsx(y,{label:"Users At Risk",value:`${O}`,onClick:()=>t("/admin/users?sort=dropOff&dir=desc&dropoffOnly=1")})]})]}),d&&d.length>0&&e.jsx(_,{labs:d}),d&&d.length===0&&e.jsx("div",{className:"rounded-2xl border border-amber-300/40 bg-amber-50/70 dark:bg-amber-900/10 p-5 text-amber-900 dark:text-amber-200",children:"No labs data available for the current scope. Try refreshing or opening the Labs page."}),e.jsx(B,{platform:o})]})]})}function w({label:t,onClick:s}){return e.jsx("button",{type:"button",onClick:s,className:"rounded-xl border border-slate-300/70 bg-white/90 px-3 py-2 text-sm text-slate-800 shadow-sm hover:bg-white dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-100 dark:hover:bg-slate-900",children:t})}function y({label:t,value:s,onClick:r}){return e.jsxs("button",{type:"button",onClick:r,className:"text-left rounded-xl border border-rose-200/70 dark:border-rose-800/50 bg-white/80 dark:bg-slate-900/50 p-4 hover:bg-white dark:hover:bg-slate-900 transition",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-rose-700 dark:text-rose-300",children:t}),e.jsx("div",{className:"mt-1 font-semibold text-slate-900 dark:text-slate-100",children:s})]})}export{T as default};
