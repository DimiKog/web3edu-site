import{r as s,j as r}from"./vendor-react-XZtyZRd7.js";import{u as P,a as T}from"./vendor-web3-Dys35WFk.js";const O={en:{claimButton:"✅ Claim completion",claimingButton:"Signing…",successMessage:"✔ Completion recorded successfully",checkingStatus:"Checking completion status…",completedOn:"Completed on:",walletNotConnectedError:"Wallet not connected",labIdMissingError:"Lab ID missing",backendError:"Failed to record completion",backToOverview:"⬅ Back to lab overview"},gr:{claimButton:"✅ Δήλωση Ολοκλήρωσης",claimingButton:"Υπογραφή…",successMessage:"✔ Η ολοκλήρωση καταγράφηκε επιτυχώς",checkingStatus:"Έλεγχος κατάστασης ολοκλήρωσης…",completedOn:"Ολοκληρώθηκε στις:",walletNotConnectedError:"Το πορτοφόλι δεν είναι συνδεδεμένο",labIdMissingError:"Λείπει το Lab ID",backendError:"Αποτυχία καταγραφής ολοκλήρωσης",backToOverview:"⬅ Επιστροφή στην επισκόπηση"}};function z({labId:a,language:D="en",backHref:x=null,backLabel:I=null}){const n=O[D]||O.en,u="https://web3edu-api.dimikog.org",{address:i,isConnected:h}=P(),{signMessageAsync:B}=T(),[g,C]=s.useState(!1),[f,k]=s.useState(!1),[v,m]=s.useState(null),[y,E]=s.useState(!0),[M,S]=s.useState(null),[j,w]=s.useState(!1);s.useEffect(()=>{if(!h||!i||!a){E(!1);return}(async()=>{try{const o=await fetch(`${u}/labs/status?address=${i}&labId=${a}`);if(!o.ok)return;const l=await o.json();l.completed===!0&&(k(!0),S(l.completedAt||null))}catch(o){console.warn("Failed to restore lab completion state",o)}finally{E(!1)}})()},[u,h,i,a]),s.useEffect(()=>{if(!j)return;const c=1800,o=120,l=Date.now(),b=["#22c55e","#38bdf8","#a78bfa","#f59e0b","#f43f5e"],$=Array.from({length:o},()=>({x:Math.random()*window.innerWidth,y:-20-Math.random()*window.innerHeight*.4,r:2+Math.random()*5,vy:2+Math.random()*3,vx:-1.25+Math.random()*2.5,tilt:Math.random()*Math.PI*2,spin:-.1+Math.random()*.2,color:b[Math.floor(Math.random()*b.length)]})),e=document.createElement("canvas");e.width=window.innerWidth,e.height=window.innerHeight,e.style.position="fixed",e.style.inset="0",e.style.pointerEvents="none",e.style.zIndex="90",document.body.appendChild(e);const d=e.getContext("2d");if(!d){e.remove(),w(!1);return}const N=()=>{e.width=window.innerWidth,e.height=window.innerHeight};window.addEventListener("resize",N);let p=0;const A=()=>{d.clearRect(0,0,e.width,e.height),$.forEach(t=>{t.x+=t.vx+Math.sin(t.tilt)*.5,t.y+=t.vy,t.tilt+=t.spin,d.fillStyle=t.color,d.beginPath(),d.ellipse(t.x,t.y,t.r,t.r*.65,t.tilt,0,Math.PI*2),d.fill()}),Date.now()-l<c?p=requestAnimationFrame(A):w(!1)};return p=requestAnimationFrame(A),()=>{cancelAnimationFrame(p),window.removeEventListener("resize",N),e.remove()}},[j]);const L=async()=>{if(!f){if(!h||!i){m(n.walletNotConnectedError);return}if(!a){m(n.labIdMissingError);return}C(!0),m(null);try{const c=new Date().toISOString(),o=`I confirm completion of Web3Edu Lab
Lab ID: ${a}
Address: ${i}
Timestamp: ${c}`,l=await B({message:o});if(!(await fetch(`${u}/labs/complete`,{method:"POST",headers:{"Content-Type":"application/json","X-API-KEY":"1234567890DimtrisK240678Maria2806201809876543210"},body:JSON.stringify({address:i,labId:a,message:o,signature:l})})).ok)throw new Error("Backend rejected completion");k(!0),S(new Date().toISOString()),w(!0)}catch(c){console.error(c),m(n.backendError)}finally{C(!1)}}};return r.jsxs("div",{className:"mt-4",children:[y&&r.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:n.checkingStatus}),!f&&!y&&r.jsx("button",{onClick:L,disabled:g,className:`px-5 py-2 rounded-md font-semibold text-white transition ${g?"bg-slate-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:g?n.claimingButton:n.claimButton}),f&&r.jsxs("div",{className:"rounded-xl border border-green-300/60 dark:border-green-700/40 bg-green-50 dark:bg-green-900/20 p-4",children:[r.jsx("p",{className:"font-semibold text-green-700 dark:text-green-400",children:n.successMessage}),M&&r.jsxs("p",{className:"text-xs mt-1 text-green-600 dark:text-green-400",children:[n.completedOn," ",new Date(M).toLocaleString()]})]}),v&&r.jsx("p",{className:"mt-3 text-sm text-red-600 dark:text-red-400",children:v}),x&&r.jsx("a",{href:x,className:"inline-block mt-4 px-4 py-2 rounded-md bg-slate-700 text-white hover:bg-slate-800",children:I||n.backToOverview})]})}export{z as L};
