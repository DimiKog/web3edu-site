import{u as U,r as n,j as t}from"./vendor-react-DaA--_H6.js";import{u as D}from"./vendor-web3-B5M9rCAm.js";const L="https://web3edu-api.dimikog.org";function c(r,a=0){const l=Number(r);return Number.isFinite(l)?l:a}function $(r){const a=c(r?.started??r?.startedLabs??r?.labsStarted,0),l=c(r?.completed??r?.completedLabs??r?.labsCompleted,0),d=c(r?.dropOff??r?.dropOffCount,Math.max(0,a-l)),x=typeof r?.isDropOff=="boolean"?r.isDropOff:d>0;return{wallet:r?.wallet||r?.address||"—",xp:c(r?.xp??r?.totalXp,0),tier:r?.tier||r?.level||"Explorer",started:a,completed:l,dropOffCount:d,isDropOff:x,lastActivityEpoch:c(r?.lastActivityEpoch??r?.lastActiveAtEpoch,0),raw:r}}function F(r){return r.started<=0&&r.completed>0?1:r.completed/r.started}function I(r){return r>=.8?"text-emerald-600 dark:text-emerald-300":r>=.5?"text-amber-600 dark:text-amber-300":"text-rose-600 dark:text-rose-300"}function _(){const r=U(),{address:a}=D(),[l,d]=n.useState(null),[x,u]=n.useState(null),[g,j]=n.useState(""),[o,v]=n.useState("xp"),[w,k]=n.useState("desc");if(n.useEffect(()=>{const e=localStorage.getItem("adminWallet")||localStorage.getItem("web3edu-wallet-address")||localStorage.getItem("walletAddress")||localStorage.getItem("wallet")||a;if(!e){u("Admin wallet not available. Please reconnect."),d([]);return}u(null),fetch(`${L}/admin/users?wallet=${e}`).then(s=>{if(s.status===403)throw new Error("Not authorized");if(!s.ok)throw new Error("Failed to fetch users");return s.json()}).then(s=>{if(Array.isArray(s)){d(s);return}if(Array.isArray(s?.users)){d(s.users);return}d([])}).catch(()=>{u("Could not load users analytics."),d([])})},[a]),x)return t.jsx("div",{className:"max-w-4xl rounded-2xl border border-red-500/30 bg-red-500/10 text-red-200 px-6 py-4",children:x});if(!l)return t.jsx("div",{className:"max-w-4xl rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl px-6 py-4 text-slate-700 dark:text-slate-200",children:"Loading users analytics…"});const i=l.map($),N=i.length,y=i.filter(e=>String(e.tier).toLowerCase().includes("builder")).length,A=i.filter(e=>String(e.tier).toLowerCase().includes("explorer")).length,C=i.filter(e=>e.isDropOff).length,S=[...i.filter(e=>String(e.wallet).toLowerCase().includes(g.trim().toLowerCase()))].sort((e,s)=>{const f=w==="asc"?1:-1;return o==="xp"?f*(e.xp-s.xp):o==="completed"?f*(e.completed-s.completed):o==="dropOff"?f*(e.dropOffCount-s.dropOffCount):o==="lastActivity"?f*((e.lastActivityEpoch||0)-(s.lastActivityEpoch||0)):0}),E=e=>{if(!e)return"—";try{return new Date(e*1e3).toLocaleString()}catch{return"—"}},O=e=>String(e).toLowerCase().includes("builder"),m=e=>{if(o===e){k(s=>s==="desc"?"asc":"desc");return}v(e),k("desc")},p=e=>o!==e?"":w==="desc"?" ↓":" ↑";return t.jsxs("div",{className:"relative min-h-[calc(100vh-8rem)] space-y-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold tracking-tight bg-gradient-to-r from-[#FF67D2] via-[#8A57FF] to-[#4ACBFF] text-transparent bg-clip-text",children:"Users Analytics"}),t.jsx("p",{className:"text-base text-slate-600 dark:text-slate-300 mt-2",children:"User-level activity and engagement indicators"})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsx(b,{label:"Total Users",value:N}),t.jsx(b,{label:"Builders",value:y}),t.jsx(b,{label:"Explorers",value:A}),t.jsx(b,{label:"Drop-off Users",value:C})]}),t.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl shadow-[0_24px_70px_rgba(15,23,42,0.18)] p-6",children:[t.jsxs("div",{className:"mb-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[t.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Click a row for user drill-down."}),t.jsx("input",{value:g,onChange:e=>j(e.target.value),placeholder:"Filter by wallet...",className:"w-full md:w-72 rounded-xl border border-slate-300/70 bg-white/90 px-3 py-2 text-sm text-slate-800 shadow-sm focus:outline-none focus:ring-2 focus:ring-fuchsia-400/40 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-100"})]}),t.jsx("div",{className:"overflow-x-auto rounded-2xl border border-white/10 bg-white/60 dark:bg-[#0b0f17]/70 backdrop-blur-xl",children:t.jsxs("table",{className:"min-w-full text-sm",children:[t.jsx("thead",{className:"bg-white/80 dark:bg-[#111827]/80",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-3 text-left text-slate-700 dark:text-slate-200",children:"Wallet"}),t.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:t.jsx(h,{onClick:()=>m("xp"),label:`XP${p("xp")}`})}),t.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:"Tier"}),t.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:"Started"}),t.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:t.jsx(h,{onClick:()=>m("completed"),label:`Completed${p("completed")}`})}),t.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:t.jsx(h,{onClick:()=>m("dropOff"),label:`Drop-Off${p("dropOff")}`})}),t.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:"Engagement"}),t.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:t.jsx(h,{onClick:()=>m("lastActivity"),label:`Last Activity${p("lastActivity")}`})})]})}),t.jsx("tbody",{children:S.map(e=>{const s=F(e);return t.jsxs("tr",{onClick:()=>r(`/admin/users/${encodeURIComponent(e.wallet)}`,{state:{user:e.raw}}),className:`cursor-pointer border-t border-white/10 hover:bg-white/60 dark:hover:bg-white/5 ${e.isDropOff?"bg-red-50/50 dark:bg-red-900/15":""}`,children:[t.jsx("td",{className:"p-3 font-mono text-xs text-slate-900 dark:text-slate-100 underline underline-offset-2 decoration-dotted",children:e.wallet}),t.jsx("td",{className:`p-3 text-center font-semibold ${e.xp>=2e3?"text-indigo-700 dark:text-indigo-300":"text-slate-800 dark:text-slate-200"}`,children:e.xp}),t.jsx("td",{className:"p-3 text-center",children:t.jsx("span",{className:`inline-flex rounded-full px-2.5 py-1 text-xs font-semibold ${O(e.tier)?"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300":"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-200"}`,children:e.tier})}),t.jsx("td",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:e.started}),t.jsx("td",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:e.completed}),t.jsx("td",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:e.dropOffCount}),t.jsxs("td",{className:`p-3 text-center font-semibold ${I(s)}`,children:[Math.round(s*100),"%"]}),t.jsx("td",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:E(e.lastActivityEpoch)})]},e.wallet)})})]})})]})]})}function h({onClick:r,label:a}){return t.jsx("button",{type:"button",onClick:r,className:"text-center text-slate-700 hover:text-slate-900 dark:text-slate-200 dark:hover:text-white",children:a})}function b({label:r,value:a}){return t.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl p-4 shadow-md",children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400",children:r}),t.jsx("div",{className:"text-2xl font-semibold text-slate-900 dark:text-slate-100 mt-1",children:a})]})}export{_ as default};
