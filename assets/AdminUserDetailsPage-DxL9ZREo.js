import{u as S,c as $,d as L,r as n,j as e}from"./vendor-react-DaA--_H6.js";import{u as P}from"./vendor-web3-B5M9rCAm.js";const y="https://web3edu-api.dimikog.org";function X(){const o=S();$();const{address:c}=P(),{wallet:l}=L(),d=decodeURIComponent(l||""),[x,r]=n.useState(!0),[h,m]=n.useState(null),[t,j]=n.useState(null);n.useEffect(()=>{const s=localStorage.getItem("adminWallet")||localStorage.getItem("web3edu-wallet-address")||localStorage.getItem("walletAddress")||localStorage.getItem("wallet")||c;if(!s||!d){m("Missing wallet context."),r(!1);return}let a=!0;async function C(){try{const g=await fetch(`${y}/admin/users/details?wallet=${s}&user=${d}`);if(g.ok){const u=await g.json();a&&(j(u),m(null),r(!1));return}const N=await fetch(`${y}/admin/users?wallet=${s}`);if(!N.ok)throw new Error("Failed to fetch user details");const p=await N.json(),w=(Array.isArray(p)?p:Array.isArray(p?.users)?p.users:[]).find(u=>String(u?.wallet||u?.address||"").toLowerCase()===String(d).toLowerCase());if(!w)throw new Error("User not found");a&&(j({user:w}),m(null),r(!1))}catch{a&&(m("Could not load user details."),r(!1))}}return C(),()=>{a=!1}},[c,d]);const v=n.useMemo(()=>t?.labsCompleted?t.labsCompleted:[],[t]),A=n.useMemo(()=>t?.labsStartedNotCompleted?t.labsStartedNotCompleted:[],[t]),i=n.useMemo(()=>t?.xpBreakdown||null,[t]),f=n.useMemo(()=>t?.timeline?t.timeline.map(s=>({label:s?.title?.en||s?.id||s?.type||"Activity",when:s?.completedAt||"—",xp:s?.xp??null})):[],[t]);return x?e.jsx("div",{className:"max-w-4xl rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl px-6 py-4 text-slate-700 dark:text-slate-200",children:"Loading user details…"}):h?e.jsx("div",{className:"max-w-4xl rounded-2xl border border-red-500/30 bg-red-500/10 text-red-200 px-6 py-4",children:h}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-extrabold tracking-tight bg-gradient-to-r from-[#FF67D2] via-[#8A57FF] to-[#4ACBFF] text-transparent bg-clip-text",children:"User Analytics"}),t?.user&&e.jsxs("p",{className:"mt-1 text-sm text-slate-600 dark:text-slate-300",children:["Tier: ",e.jsx("span",{className:"font-semibold",children:t.user.tier})," · XP:"," ",e.jsx("span",{className:"font-semibold",children:t.user.xp})]}),e.jsx("p",{className:"mt-2 font-mono text-xs text-slate-600 dark:text-slate-300 break-all",children:d})]}),e.jsx("button",{type:"button",onClick:()=>o("/admin/users"),className:"rounded-xl border border-slate-300/70 bg-white/90 px-3 py-2 text-sm text-slate-800 shadow-sm dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-100",children:"Back to Users"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(b,{title:"Labs Completed List",children:e.jsx(k,{items:v,emptyMessage:"No completed labs available."})}),e.jsx(b,{title:"Labs Started but Not Completed",children:e.jsx(k,{items:A,emptyMessage:"No incomplete labs available."})}),e.jsx(b,{title:"XP Breakdown",children:i?e.jsxs("div",{className:"space-y-4 text-sm",children:[i.labs?.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"Labs"}),e.jsx("ul",{className:"space-y-1",children:i.labs.map((s,a)=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:s.labId}),e.jsxs("span",{className:"font-medium",children:[s.xp," XP"]})]},`lab-${a}`))})]}),i.lessons?.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"Lessons"}),e.jsx("ul",{className:"space-y-1",children:i.lessons.map((s,a)=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:s.lessonId||"Lesson"}),e.jsxs("span",{className:"font-medium",children:[s.xp," XP"]})]},`lesson-${a}`))})]}),i.projects?.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"Projects"}),e.jsx("ul",{className:"space-y-1",children:i.projects.map((s,a)=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:s.projectId}),e.jsx("span",{className:"font-medium",children:"Completed"})]},`project-${a}`))})]})]}):e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No XP breakdown available."})}),e.jsx(b,{title:"Timeline of Activity",children:f.length?e.jsx("div",{className:"space-y-2",children:f.map((s,a)=>e.jsxs("div",{className:"rounded-lg border border-white/10 bg-white/60 dark:bg-slate-900/40 px-3 py-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:s.label}),s.xp!==null&&e.jsxs("p",{className:"text-xs font-medium text-emerald-400",children:[s.xp," XP"]})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:s.when})]},`${s.label}-${a}`))}):e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No timeline entries available."})})]})]})}function b({title:o,children:c}){return e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl shadow-[0_24px_70px_rgba(15,23,42,0.18)] p-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-3",children:o}),c]})}function k({items:o,emptyMessage:c}){return o.length?e.jsx("ul",{className:"space-y-2",children:o.map((l,d)=>{const x=l?.title?.en||l?.labId||l?.projectId||String(l),r=l?.completedAt||l?.startedAt||l?.xp;return e.jsx("li",{className:"rounded-lg border border-white/10 bg-white/60 dark:bg-slate-900/40 px-3 py-2 text-sm text-slate-800 dark:text-slate-200",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:x}),r&&e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:typeof r=="number"?`${r} XP`:r})]})},`${x}-${d}`)})}):e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:c})}export{X as default};
