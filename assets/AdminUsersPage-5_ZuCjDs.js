import{r as i,j as l,u as Ce,e as Ie}from"./vendor-react-XZtyZRd7.js";import{c as w,p as F,a as De,i as Te,s as _,b as Le,d as Re,e as ge,f as _e,g as Ke,h as L,j as Me,k as $e,l as Ue,m as Fe,n as xe,o as Be,q as We,r as Ge,t as Ve,u as be,v as ze,w as Xe,x as Ze,y as he,z as qe,A as te,B as ye,R as He,S as Je,D as Pe,C as Ae,E as $,F as Qe,L as K,Z as je,G as ae,H as Ye,I as et,J as tt,K as at,M as se,N as ie,O as q,P as Y,Q as rt,T as nt,U as lt,V as st,W as it,X as ot,Y as ct,_ as dt,$ as ut,a0 as mt,a1 as pt,a2 as ft,a3 as vt,a4 as U,a5 as oe,a6 as gt,a7 as xt,a8 as bt,a9 as ht,aa as yt,ab as Pt,ac as At,ad as jt,ae as wt,af as Ot,ag as kt,ah as Et,ai as Nt,aj as St}from"./CategoricalChart-sZ5-gRKd.js";import{g as re,u as Ct}from"./vendor-web3-Dys35WFk.js";var we=e=>e.graphicalItems.polarItems,It=w([F,De],Te),H=w([we,_,It],Le),Dt=w([H],Re),J=w([Dt,ge],_e),Tt=w([J,_,H],Ke);w([J,_,H],(e,t,a)=>a.length>0?e.flatMap(r=>a.flatMap(n=>{var s,c=L(r,(s=t.dataKey)!==null&&s!==void 0?s:n.dataKey);return{value:c,errorDomain:[]}})).filter(Boolean):t?.dataKey!=null?e.map(r=>({value:L(r,t.dataKey),errorDomain:[]})):e.map(r=>({value:r,errorDomain:[]})));var ce=()=>{},Lt=w([J,_,H,Me,F],$e),Rt=w([_,Ue,Fe,ce,Lt,ce,xe,F],Be),Oe=w([_,xe,J,Tt,We,F,Rt],Ge),_t=w([Oe,Ve,be],ze),Kt=w([_,Oe,_t,F],Xe);w([be,Kt],Ze);function de(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),a.push.apply(a,r)}return a}function ue(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?de(Object(a),!0).forEach(function(r){Mt(e,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):de(Object(a)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))})}return e}function Mt(e,t,a){return(t=$t(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function $t(e){var t=Ut(e,"string");return typeof t=="symbol"?t:t+""}function Ut(e,t){if(typeof e!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var r=a.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ft=(e,t)=>t,ne=w([we,Ft],(e,t)=>e.filter(a=>a.type==="pie").find(a=>a.id===t)),Bt=[],le=(e,t,a)=>a?.length===0?Bt:a,ke=w([ge,ne,le],(e,t,a)=>{var{chartData:r}=e;if(t!=null){var n;if(t?.data!=null&&t.data.length>0?n=t.data:n=r,(!n||!n.length)&&a!=null&&(n=a.map(s=>ue(ue({},t.presentationProps),s.props))),n!=null)return n}}),Wt=w([ke,ne,le],(e,t,a)=>{if(!(e==null||t==null))return e.map((r,n)=>{var s,c=L(r,t.nameKey,t.name),u;return a!=null&&(s=a[n])!==null&&s!==void 0&&(s=s.props)!==null&&s!==void 0&&s.fill?u=a[n].props.fill:typeof r=="object"&&r!=null&&"fill"in r?u=r.fill:u=t.fill,{value:he(c,t.dataKey),color:u,payload:r,type:t.legendType}})}),Gt=w([ke,ne,le,qe],(e,t,a,r)=>{if(!(t==null||e==null))return da({offset:r,pieSettings:t,displayedData:e,cells:a})}),Vt=["key"],zt=["onMouseEnter","onClick","onMouseLeave"],Xt=["id"],Zt=["id"];function me(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),a.push.apply(a,r)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?me(Object(a),!0).forEach(function(r){qt(e,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):me(Object(a)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))})}return e}function qt(e,t,a){return(t=Ht(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ht(e){var t=Jt(e,"string");return typeof t=="symbol"?t:t+""}function Jt(e,t){if(typeof e!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var r=a.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function R(){return R=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},R.apply(null,arguments)}function Q(e,t){if(e==null)return{};var a,r,n=Qt(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)===-1&&{}.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Qt(e,t){if(e==null)return{};var a={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)!==-1)continue;a[r]=e[r]}return a}function Yt(e){var t=i.useMemo(()=>Ae(e.children,ae),[e.children]),a=$(r=>Wt(r,e.id,t));return a==null?null:i.createElement(Qe,{legendPayload:a})}var ea=i.memo(e=>{var{dataKey:t,nameKey:a,sectors:r,stroke:n,strokeWidth:s,fill:c,name:u,hide:v,tooltipType:m,id:P}=e,b={dataDefinedOnItem:r.map(d=>d.tooltipPayload),getPosition:d=>{var x;return(x=r[Number(d)])===null||x===void 0?void 0:x.tooltipPosition},settings:{stroke:n,strokeWidth:s,fill:c,dataKey:t,nameKey:a,name:he(u,t),hide:v,type:m,color:c,unit:"",graphicalItemId:P}};return i.createElement(Ye,{tooltipEntrySettings:b})}),ta=(e,t)=>e>t?"start":e<t?"end":"middle",aa=(e,t,a)=>typeof t=="function"?U(t(e),a,a*.8):U(t,a,a*.8),ra=(e,t,a)=>{var{top:r,left:n,width:s,height:c}=t,u=vt(s,c),v=n+U(e.cx,s,s/2),m=r+U(e.cy,c,c/2),P=U(e.innerRadius,u,0),b=aa(a,e.outerRadius,u),d=e.maxRadius||Math.sqrt(s*s+c*c)/2;return{cx:v,cy:m,innerRadius:P,outerRadius:b,maxRadius:d}},na=(e,t)=>{var a=q(t-e),r=Math.min(Math.abs(t-e),360);return a*r},la=(e,t)=>{if(i.isValidElement(e))return i.cloneElement(e,t);if(typeof e=="function")return e(t);var a=re("recharts-pie-label-line",typeof e!="boolean"?e.className:""),{key:r}=t,n=Q(t,Vt);return i.createElement(gt,R({},n,{type:"linear",className:a}))},sa=(e,t,a)=>{if(i.isValidElement(e))return i.cloneElement(e,t);var r=a;if(typeof e=="function"&&(r=e(t),i.isValidElement(r)))return r;var n=re("recharts-pie-label-text",xt(e));return i.createElement(bt,R({},t,{alignmentBaseline:"middle",className:n}),r)};function ia(e){var{sectors:t,props:a,showLabels:r}=e,{label:n,labelLine:s,dataKey:c}=a;if(!r||!n||!t)return null;var u=ye(a),v=oe(n),m=oe(s),P=typeof n=="object"&&"offsetRadius"in n&&typeof n.offsetRadius=="number"&&n.offsetRadius||20,b=t.map((d,x)=>{var h=(d.startAngle+d.endAngle)/2,O=Y(d.cx,d.cy,d.outerRadius+P,h),N=g(g(g(g({},u),d),{},{stroke:"none"},v),{},{index:x,textAnchor:ta(O.x,d.cx)},O),p=g(g(g(g({},u),d),{},{fill:"none",stroke:d.fill},m),{},{index:x,points:[Y(d.cx,d.cy,d.outerRadius,h),O],key:"line"});return i.createElement(je,{zIndex:Pe.label,key:"label-".concat(d.startAngle,"-").concat(d.endAngle,"-").concat(d.midAngle,"-").concat(x)},i.createElement(K,null,s&&la(s,p),sa(n,N,L(d,c))))});return i.createElement(K,{className:"recharts-pie-labels"},b)}function oa(e){var{sectors:t,props:a,showLabels:r}=e,{label:n}=a;return typeof n=="object"&&n!=null&&"position"in n?i.createElement(ft,{label:n}):i.createElement(ia,{sectors:t,props:a,showLabels:r})}function ca(e){var{sectors:t,activeShape:a,inactiveShape:r,allOtherPieProps:n,shape:s,id:c}=e,u=$(nt),v=$(lt),m=$(st),{onMouseEnter:P,onClick:b,onMouseLeave:d}=n,x=Q(n,zt),h=it(P,n.dataKey,c),O=ot(d),N=ct(b,n.dataKey,c);return t==null||t.length===0?null:i.createElement(i.Fragment,null,t.map((p,k)=>{if(p?.startAngle===0&&p?.endAngle===0&&t.length!==1)return null;var D=m==null||m===c,S=String(k)===u&&(v==null||n.dataKey===v)&&D,C=u?r:null,A=a&&S?a:C,j=g(g({},p),{},{stroke:p.stroke,tabIndex:-1,[ut]:k,[dt]:c});return i.createElement(K,R({key:"sector-".concat(p?.startAngle,"-").concat(p?.endAngle,"-").concat(p.midAngle,"-").concat(k),tabIndex:-1,className:"recharts-pie-sector"},mt(x,p,k),{onMouseEnter:h(p,k),onMouseLeave:O(p,k),onClick:N(p,k)}),i.createElement(pt,R({option:s??A,index:k,shapeType:"sector",isActive:S},j)))}))}function da(e){var t,{pieSettings:a,displayedData:r,cells:n,offset:s}=e,{cornerRadius:c,startAngle:u,endAngle:v,dataKey:m,nameKey:P,tooltipType:b}=a,d=Math.abs(a.minAngle),x=na(u,v),h=Math.abs(x),O=r.length<=1?0:(t=a.paddingAngle)!==null&&t!==void 0?t:0,N=r.filter(A=>L(A,m,0)!==0).length,p=(h>=360?N:N-1)*O,k=h-N*d-p,D=r.reduce((A,j)=>{var y=L(j,m,0);return A+(ie(y)?y:0)},0),S;if(D>0){var C;S=r.map((A,j)=>{var y=L(A,m,0),T=L(A,P,j),E=ra(a,s,A),o=(ie(y)?y:0)/D,f,I=g(g({},A),n&&n[j]&&n[j].props);j?f=C.endAngle+q(x)*O*(y!==0?1:0):f=u;var B=f+q(x)*((y!==0?d:0)+o*k),W=(f+B)/2,G=(E.innerRadius+E.outerRadius)/2,V=[{name:T,value:y,payload:I,dataKey:m,type:b,graphicalItemId:a.id}],Se=Y(E.cx,E.cy,G,W);return C=g(g(g(g({},a.presentationProps),{},{percent:o,cornerRadius:typeof c=="string"?parseFloat(c):c,name:T,tooltipPayload:V,midAngle:W,middleRadius:G,tooltipPosition:Se},I),E),{},{value:y,dataKey:m,startAngle:f,endAngle:B,payload:I,paddingAngle:q(x)*O}),C})}return S}function ua(e){var{showLabels:t,sectors:a,children:r}=e,n=i.useMemo(()=>!t||!a?[]:a.map(s=>({value:s.value,payload:s.payload,clockWise:!1,parentViewBox:void 0,viewBox:{cx:s.cx,cy:s.cy,innerRadius:s.innerRadius,outerRadius:s.outerRadius,startAngle:s.startAngle,endAngle:s.endAngle,clockWise:!1},fill:s.fill})),[a,t]);return i.createElement(rt,{value:t?n:void 0},r)}function ma(e){var{props:t,previousSectorsRef:a,id:r}=e,{sectors:n,isAnimationActive:s,animationBegin:c,animationDuration:u,animationEasing:v,activeShape:m,inactiveShape:P,onAnimationStart:b,onAnimationEnd:d}=t,x=et(t,"recharts-pie-"),h=a.current,[O,N]=i.useState(!1),p=i.useCallback(()=>{typeof d=="function"&&d(),N(!1)},[d]),k=i.useCallback(()=>{typeof b=="function"&&b(),N(!0)},[b]);return i.createElement(ua,{showLabels:!O,sectors:n},i.createElement(tt,{animationId:x,begin:c,duration:u,isActive:s,easing:v,onAnimationStart:k,onAnimationEnd:p,key:x},D=>{var S,C=[],A=n&&n[0],j=(S=A?.startAngle)!==null&&S!==void 0?S:0;return n?.forEach((y,T)=>{var E=h&&h[T],o=T>0?at(y,"paddingAngle",0):0;if(E){var f=se(E.endAngle-E.startAngle,y.endAngle-y.startAngle,D),I=g(g({},y),{},{startAngle:j+o,endAngle:j+f+o});C.push(I),j=I.endAngle}else{var{endAngle:B,startAngle:W}=y,G=se(0,B-W,D),V=g(g({},y),{},{startAngle:j+o,endAngle:j+G+o});C.push(V),j=V.endAngle}}),a.current=C,i.createElement(K,null,i.createElement(ca,{sectors:C,activeShape:m,inactiveShape:P,allOtherPieProps:t,shape:t.shape,id:r}))}),i.createElement(oa,{showLabels:!O,sectors:n,props:t}),t.children)}var pa={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:"auto",label:!1,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff",zIndex:Pe.area};function fa(e){var{id:t}=e,a=Q(e,Xt),{hide:r,className:n,rootTabIndex:s}=e,c=i.useMemo(()=>Ae(e.children,ae),[e.children]),u=$(P=>Gt(P,t,c)),v=i.useRef(null),m=re("recharts-pie",n);return r||u==null?(v.current=null,i.createElement(K,{tabIndex:s,className:m})):i.createElement(je,{zIndex:e.zIndex},i.createElement(ea,{dataKey:e.dataKey,nameKey:e.nameKey,sectors:u,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill,name:e.name,hide:e.hide,tooltipType:e.tooltipType,id:t}),i.createElement(K,{tabIndex:s,className:m},i.createElement(ma,{props:g(g({},a),{},{sectors:u}),previousSectorsRef:v,id:t})))}function Ee(e){var t=te(e,pa),{id:a}=t,r=Q(t,Zt),n=ye(r);return i.createElement(He,{id:a,type:"pie"},s=>i.createElement(i.Fragment,null,i.createElement(Je,{type:"pie",id:s,data:r.data,dataKey:r.dataKey,hide:r.hide,angleAxisId:0,radiusAxisId:0,name:r.name,nameKey:r.nameKey,tooltipType:r.tooltipType,legendType:r.legendType,fill:r.fill,cx:r.cx,cy:r.cy,startAngle:r.startAngle,endAngle:r.endAngle,paddingAngle:r.paddingAngle,minAngle:r.minAngle,innerRadius:r.innerRadius,outerRadius:r.outerRadius,cornerRadius:r.cornerRadius,presentationProps:n,maxRadius:t.maxRadius}),i.createElement(Yt,R({},r,{id:s})),i.createElement(fa,R({},r,{id:s}))))}Ee.displayName="Pie";function va(e){var t=ht();return i.useEffect(()=>{t(yt(e))},[t,e]),null}var ga=["layout"];function ee(){return ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},ee.apply(null,arguments)}function xa(e,t){if(e==null)return{};var a,r,n=ba(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)===-1&&{}.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ba(e,t){if(e==null)return{};var a={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)!==-1)continue;a[r]=e[r]}return a}var ha={top:5,right:5,bottom:5,left:5},Ne={accessibilityLayer:!0,stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:ha,reverseStackOrder:!1,syncMethod:"index",layout:"radial",responsive:!1,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},ya=i.forwardRef(function(t,a){var r,n=te(t.categoricalChartProps,Ne),{layout:s}=n,c=xa(n,ga),{chartName:u,defaultTooltipEventType:v,validateTooltipEventTypes:m,tooltipPayloadSearcher:P}=t,b={chartName:u,defaultTooltipEventType:v,validateTooltipEventTypes:m,tooltipPayloadSearcher:P,eventEmitter:void 0};return i.createElement(Pt,{preloadedState:{options:b},reduxStoreName:(r=n.id)!==null&&r!==void 0?r:u},i.createElement(At,{chartData:n.data}),i.createElement(jt,{layout:s,margin:n.margin}),i.createElement(wt,{baseValue:void 0,accessibilityLayer:n.accessibilityLayer,barCategoryGap:n.barCategoryGap,maxBarSize:n.maxBarSize,stackOffset:n.stackOffset,barGap:n.barGap,barSize:n.barSize,syncId:n.syncId,syncMethod:n.syncMethod,className:n.className,reverseStackOrder:n.reverseStackOrder}),i.createElement(va,{cx:n.cx,cy:n.cy,startAngle:n.startAngle,endAngle:n.endAngle,innerRadius:n.innerRadius,outerRadius:n.outerRadius}),i.createElement(Ot,ee({},c,{ref:a})))});function pe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),a.push.apply(a,r)}return a}function fe(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?pe(Object(a),!0).forEach(function(r){Pa(e,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pe(Object(a)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))})}return e}function Pa(e,t,a){return(t=Aa(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Aa(e){var t=ja(e,"string");return typeof t=="symbol"?t:t+""}function ja(e,t){if(typeof e!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var r=a.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var wa=["item"],Oa=fe(fe({},Ne),{},{layout:"centric",startAngle:0,endAngle:360}),ka=i.forwardRef((e,t)=>{var a=te(e,Oa);return i.createElement(ya,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:wa,tooltipPayloadSearcher:kt,categoricalChartProps:a,ref:t})});const z={builders:"#f59e0b",explorers:"#6366f1",dropOff:"#f43f5e",active:"#10b981"};function ve({data:e,type:t="tier"}){if(!e||e.length===0)return l.jsx("div",{className:"flex items-center justify-center h-64 text-slate-500 dark:text-slate-400",children:"No user data available"});let a=[];if(t==="tier"){const n=e.filter(c=>String(c?.tier||c?.level||"").toLowerCase().includes("builder")).length,s=e.length-n;a=[{name:"Builders",value:n,color:z.builders},{name:"Explorers",value:s,color:z.explorers}]}else if(t==="engagement"){const n=e.filter(c=>{const u=c?.started||c?.labsStarted||0,v=c?.completed||c?.labsCompleted||0;return u<=0?v>0:v/u>=.5}).length,s=e.length-n;a=[{name:"Engaged (50%+)",value:n,color:z.active},{name:"Low Engagement",value:s,color:z.dropOff}]}const r=a.reduce((n,s)=>n+s.value,0);return l.jsx("div",{className:"w-full h-64",children:l.jsx(Et,{width:"100%",height:"100%",children:l.jsxs(ka,{children:[l.jsx(Ee,{data:a,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:4,dataKey:"value",stroke:"none",children:a.map((n,s)=>l.jsx(ae,{fill:n.color},`cell-${s}`))}),l.jsx(Nt,{content:l.jsx(Ea,{total:r})}),l.jsx(St,{verticalAlign:"bottom",height:36,formatter:(n,s)=>l.jsx("span",{className:"text-slate-600 dark:text-slate-300 text-sm",children:n})})]})})})}function Ea({active:e,payload:t,total:a}){if(!e||!t||!t.length)return null;const r=t[0]?.payload;if(!r)return null;const n=a>0?Math.round(r.value/a*100):0;return l.jsxs("div",{className:"rounded-xl border border-white/20 bg-slate-900/95 backdrop-blur-sm px-4 py-3 shadow-xl",children:[l.jsx("p",{className:"font-semibold text-white mb-1",children:r.name}),l.jsxs("p",{className:"text-slate-300 text-sm",children:["Count: ",l.jsx("span",{className:"font-medium text-white",children:r.value})]}),l.jsxs("p",{className:"text-slate-300 text-sm",children:["Percentage: ",l.jsxs("span",{className:"font-medium text-white",children:[n,"%"]})]})]})}const Na="https://web3edu-api.dimikog.org";function M(e,t=0){const a=Number(e);return Number.isFinite(a)?a:t}function Sa(e){const t=M(e?.started??e?.startedLabs??e?.labsStarted,0),a=M(e?.completed??e?.completedLabs??e?.labsCompleted,0),r=M(e?.dropOff??e?.dropOffCount,Math.max(0,t-a)),n=typeof e?.isDropOff=="boolean"?e.isDropOff:r>0;return{wallet:e?.wallet||e?.address||"—",xp:M(e?.xp??e?.totalXp,0),tier:e?.tier||e?.level||"Explorer",started:t,completed:a,dropOffCount:r,isDropOff:n,lastActivityEpoch:M(e?.lastActivityEpoch??e?.lastActiveAtEpoch,0),raw:e}}function Ca(e){return e.started<=0&&e.completed>0?1:e.completed/e.started}function Ia(e){return e>=.8?"text-emerald-600 dark:text-emerald-300":e>=.5?"text-amber-600 dark:text-amber-300":"text-rose-600 dark:text-rose-300"}function Ra(){const e=Ce(),[t]=Ie(),{address:a}=Ct(),[r,n]=i.useState(null),[s,c]=i.useState(null),[u,v]=i.useState(t.get("q")||""),[m,P]=i.useState(t.get("sort")||"xp"),[b,d]=i.useState(t.get("dir")||"desc"),x=()=>{const o=localStorage.getItem("adminWallet")||localStorage.getItem("web3edu-wallet-address")||localStorage.getItem("walletAddress")||localStorage.getItem("wallet")||a;if(!o){c("Admin wallet not available. Please reconnect."),n([]);return}c(null),fetch(`${Na}/admin/users?wallet=${o}`).then(f=>{if(f.status===403)throw new Error("Not authorized");if(!f.ok)throw new Error("Failed to fetch users");return f.json()}).then(f=>{if(Array.isArray(f)){n(f);return}if(Array.isArray(f?.users)){n(f.users);return}n([])}).catch(()=>{c("Could not load users analytics."),n([])})};if(i.useEffect(()=>{x()},[a]),s)return l.jsxs("div",{className:"max-w-4xl rounded-2xl border border-red-500/30 bg-red-500/10 text-red-200 px-6 py-4 space-y-3",children:[l.jsx("div",{children:s}),l.jsx("button",{type:"button",onClick:x,className:"rounded-lg border border-red-300/40 bg-red-500/20 px-3 py-1.5 text-sm",children:"Retry"})]});if(!r)return l.jsx("div",{className:"max-w-4xl rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl px-6 py-4 text-slate-700 dark:text-slate-200",children:"Loading users analytics…"});const h=r.map(Sa),O=h.length,N=h.filter(o=>String(o.tier).toLowerCase().includes("builder")).length,p=h.filter(o=>String(o.tier).toLowerCase().includes("explorer")).length,k=h.filter(o=>o.isDropOff).length,D=h.filter(o=>String(o.wallet).toLowerCase().includes(u.trim().toLowerCase())),S=t.get("dropoffOnly")==="1",A=[...S?D.filter(o=>o.isDropOff):D].sort((o,f)=>{const I=b==="asc"?1:-1;return m==="xp"?I*(o.xp-f.xp):m==="completed"?I*(o.completed-f.completed):m==="dropOff"?I*(o.dropOffCount-f.dropOffCount):m==="lastActivity"?I*((o.lastActivityEpoch||0)-(f.lastActivityEpoch||0)):0}),j=o=>{if(!o)return"—";try{return new Date(o*1e3).toLocaleString()}catch{return"—"}},y=o=>String(o).toLowerCase().includes("builder"),T=o=>{if(m===o){d(f=>f==="desc"?"asc":"desc");return}P(o),d("desc")},E=o=>m!==o?"":b==="desc"?" ↓":" ↑";return l.jsxs("div",{className:"relative min-h-[calc(100vh-8rem)] space-y-8",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold tracking-tight bg-gradient-to-r from-[#FF67D2] via-[#8A57FF] to-[#4ACBFF] text-transparent bg-clip-text",children:"Users Analytics"}),l.jsx("p",{className:"text-base text-slate-600 dark:text-slate-300 mt-2",children:"User-level activity and engagement indicators"})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsx(Z,{label:"Total Users",value:O}),l.jsx(Z,{label:"Builders",value:N}),l.jsx(Z,{label:"Explorers",value:p}),l.jsx(Z,{label:"Drop-off Users",value:k})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl shadow-[0_24px_70px_rgba(15,23,42,0.18)] p-5",children:[l.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"User Tiers"}),l.jsx(ve,{data:h,type:"tier"})]}),l.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl shadow-[0_24px_70px_rgba(15,23,42,0.18)] p-5",children:[l.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"Engagement Level"}),l.jsx(ve,{data:h,type:"engagement"})]})]}),l.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl shadow-[0_24px_70px_rgba(15,23,42,0.18)] p-6",children:[l.jsxs("div",{className:"mb-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[l.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:["Click a row for user drill-down. ",S?"Showing drop-off users only.":""]}),l.jsx("input",{value:u,onChange:o=>v(o.target.value),placeholder:"Filter by wallet...",className:"w-full md:w-72 rounded-xl border border-slate-300/70 bg-white/90 px-3 py-2 text-sm text-slate-800 shadow-sm focus:outline-none focus:ring-2 focus:ring-fuchsia-400/40 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-100"})]}),l.jsx("div",{className:"overflow-x-auto rounded-2xl border border-white/10 bg-white/60 dark:bg-[#0b0f17]/70 backdrop-blur-xl",children:l.jsxs("table",{className:"min-w-full text-sm",children:[l.jsx("thead",{className:"bg-white/80 dark:bg-[#111827]/80",children:l.jsxs("tr",{children:[l.jsx("th",{className:"p-3 text-left text-slate-700 dark:text-slate-200",children:"Wallet"}),l.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:l.jsx(X,{onClick:()=>T("xp"),label:`XP${E("xp")}`})}),l.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:"Tier"}),l.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:"Started"}),l.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:l.jsx(X,{onClick:()=>T("completed"),label:`Completed${E("completed")}`})}),l.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:l.jsx(X,{onClick:()=>T("dropOff"),label:`Drop-Off${E("dropOff")}`})}),l.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:"Engagement"}),l.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:l.jsx(X,{onClick:()=>T("lastActivity"),label:`Last Activity${E("lastActivity")}`})})]})}),l.jsx("tbody",{children:A.map(o=>{const f=Ca(o);return l.jsxs("tr",{onClick:()=>e(`/admin/users/${encodeURIComponent(o.wallet)}`,{state:{user:o.raw}}),className:`cursor-pointer border-t border-white/10 hover:bg-white/60 dark:hover:bg-white/5 ${o.isDropOff?"bg-red-50/50 dark:bg-red-900/15":""}`,children:[l.jsx("td",{className:"p-3 font-mono text-xs text-slate-900 dark:text-slate-100 underline underline-offset-2 decoration-dotted",children:o.wallet}),l.jsx("td",{className:`p-3 text-center font-semibold ${o.xp>=2e3?"text-indigo-700 dark:text-indigo-300":"text-slate-800 dark:text-slate-200"}`,children:o.xp}),l.jsx("td",{className:"p-3 text-center",children:l.jsx("span",{className:`inline-flex rounded-full px-2.5 py-1 text-xs font-semibold ${y(o.tier)?"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300":"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-200"}`,children:o.tier})}),l.jsx("td",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:o.started}),l.jsx("td",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:o.completed}),l.jsx("td",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:o.dropOffCount}),l.jsxs("td",{className:`p-3 text-center font-semibold ${Ia(f)}`,children:[Math.round(f*100),"%"]}),l.jsx("td",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:j(o.lastActivityEpoch)})]},o.wallet)})})]})}),A.length===0&&l.jsx("div",{className:"mt-4 rounded-xl border border-amber-300/40 bg-amber-50/70 dark:bg-amber-900/10 p-4 text-amber-900 dark:text-amber-200",children:"No users matched the current filter. Try adjusting search or clearing drop-off scope."})]})]})}function X({onClick:e,label:t}){return l.jsx("button",{type:"button",onClick:e,className:"text-center text-slate-700 hover:text-slate-900 dark:text-slate-200 dark:hover:text-white",children:t})}function Z({label:e,value:t}){return l.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl p-4 shadow-md",children:[l.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400",children:e}),l.jsx("div",{className:"text-2xl font-semibold text-slate-900 dark:text-slate-100 mt-1",children:t})]})}export{Ra as default};
