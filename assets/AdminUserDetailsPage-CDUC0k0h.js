import{u as C,c as $,d as L,r as n,j as e}from"./vendor-react-DaA--_H6.js";import{u as I}from"./vendor-web3-B5M9rCAm.js";const k="https://web3edu-api.dimikog.org";function B(){const i=C();$();const{address:o}=I(),{wallet:a}=L(),d=decodeURIComponent(a||""),[c,l]=n.useState(!0),[p,x]=n.useState(null),[t,h]=n.useState(null);n.useEffect(()=>{const s=localStorage.getItem("adminWallet")||localStorage.getItem("web3edu-wallet-address")||localStorage.getItem("walletAddress")||localStorage.getItem("wallet")||o;if(!s||!d){x("Missing wallet context."),l(!1);return}let r=!0;async function A(){try{const j=await fetch(`${k}/admin/users/details?wallet=${s}&user=${d}`);if(j.ok){const u=await j.json();r&&(h(u),x(null),l(!1));return}const w=await fetch(`${k}/admin/users?wallet=${s}`);if(!w.ok)throw new Error("Failed to fetch user details");const m=await w.json(),N=(Array.isArray(m)?m:Array.isArray(m?.users)?m.users:[]).find(u=>String(u?.wallet||u?.address||"").toLowerCase()===String(d).toLowerCase());if(!N)throw new Error("User not found");r&&(h({user:N}),x(null),l(!1))}catch{r&&(x("Could not load user details."),l(!1))}}return A(),()=>{r=!1}},[o,d]);const v=n.useMemo(()=>t?.labsCompleted?t.labsCompleted:[],[t]),S=n.useMemo(()=>t?.labsStartedNotCompleted?t.labsStartedNotCompleted:[],[t]),g=n.useMemo(()=>t?.xpBreakdown||null,[t]),f=n.useMemo(()=>t?.timeline?t.timeline:[],[t]);return c?e.jsx("div",{className:"max-w-4xl rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl px-6 py-4 text-slate-700 dark:text-slate-200",children:"Loading user details…"}):p?e.jsx("div",{className:"max-w-4xl rounded-2xl border border-red-500/30 bg-red-500/10 text-red-200 px-6 py-4",children:p}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-extrabold tracking-tight bg-gradient-to-r from-[#FF67D2] via-[#8A57FF] to-[#4ACBFF] text-transparent bg-clip-text",children:"User Analytics"}),t?.user&&e.jsxs("p",{className:"mt-1 text-sm text-slate-600 dark:text-slate-300",children:["Tier: ",e.jsx("span",{className:"font-semibold",children:t.user.tier})," · XP:"," ",e.jsx("span",{className:"font-semibold",children:t.user.xp})]}),e.jsx("p",{className:"mt-2 font-mono text-xs text-slate-600 dark:text-slate-300 break-all",children:d})]}),e.jsx("button",{type:"button",onClick:()=>i("/admin/users"),className:"rounded-xl border border-slate-300/70 bg-white/90 px-3 py-2 text-sm text-slate-800 shadow-sm dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-100",children:"Back to Users"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(b,{title:"Labs Completed List",children:e.jsx(y,{items:v,emptyMessage:"No completed labs available."})}),e.jsx(b,{title:"Labs Started but Not Completed",children:e.jsx(y,{items:S,emptyMessage:"No incomplete labs available."})}),e.jsx(b,{title:"XP Breakdown",children:g?e.jsx("div",{className:"space-y-2",children:Object.entries(g).map(([s,r])=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:s}),e.jsx("span",{className:"font-semibold text-slate-900 dark:text-slate-100",children:String(r)})]},s))}):e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No XP breakdown available."})}),e.jsx(b,{title:"Timeline of Activity",children:f.length?e.jsx("div",{className:"space-y-2",children:f.map((s,r)=>e.jsxs("div",{className:"rounded-lg border border-white/10 bg-white/60 dark:bg-slate-900/40 px-3 py-2",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:s.label}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:s.when||"—"})]},`${s.label}-${r}`))}):e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No timeline entries available."})})]})]})}function b({title:i,children:o}){return e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl shadow-[0_24px_70px_rgba(15,23,42,0.18)] p-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-3",children:i}),o]})}function y({items:i,emptyMessage:o}){return i.length?e.jsx("ul",{className:"space-y-2",children:i.map((a,d)=>{const c=a?.title?.en||a?.labId||a?.projectId||String(a),l=a?.completedAt||a?.startedAt||a?.xp;return e.jsx("li",{className:"rounded-lg border border-white/10 bg-white/60 dark:bg-slate-900/40 px-3 py-2 text-sm text-slate-800 dark:text-slate-200",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:c}),l&&e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:typeof l=="number"?`${l} XP`:l})]})},`${c}-${d}`)})}):e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:o})}export{B as default};
