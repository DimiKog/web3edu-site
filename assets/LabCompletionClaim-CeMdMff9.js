import{r as o,j as t}from"./vendor-react-DaA--_H6.js";import{u as N,a as v}from"./vendor-web3-B5M9rCAm.js";const w={en:{claimButton:"✅ Claim completion",claimingButton:"Signing…",successMessage:"✔ Completion recorded successfully",checkingStatus:"Checking completion status…",completedOn:"Completed on:",walletNotConnectedError:"Wallet not connected",labIdMissingError:"Lab ID missing",backendError:"Failed to record completion",backToOverview:"⬅ Back to lab overview"},gr:{claimButton:"✅ Δήλωση Ολοκλήρωσης",claimingButton:"Υπογραφή…",successMessage:"✔ Η ολοκλήρωση καταγράφηκε επιτυχώς",checkingStatus:"Έλεγχος κατάστασης ολοκλήρωσης…",completedOn:"Ολοκληρώθηκε στις:",walletNotConnectedError:"Το πορτοφόλι δεν είναι συνδεδεμένο",labIdMissingError:"Λείπει το Lab ID",backendError:"Αποτυχία καταγραφής ολοκλήρωσης",backToOverview:"⬅ Επιστροφή στην επισκόπηση"}};function A({labId:n,language:S="en",backHref:g=null,backLabel:E=null}){const e=w[S]||w.en,l="https://web3edu-api.dimikog.org",{address:r,isConnected:d}=N(),{signMessageAsync:j}=v(),[m,p]=o.useState(!1),[u,b]=o.useState(!1),[h,a]=o.useState(null),[x,f]=o.useState(!0),[k,C]=o.useState(null);o.useEffect(()=>{if(!d||!r||!n){f(!1);return}(async()=>{try{const s=await fetch(`${l}/labs/status?address=${r}&labId=${n}`);if(!s.ok)return;const i=await s.json();i.completed===!0&&(b(!0),C(i.completedAt||null))}catch(s){console.warn("Failed to restore lab completion state",s)}finally{f(!1)}})()},[l,d,r,n]);const y=async()=>{if(!u){if(!d||!r){a(e.walletNotConnectedError);return}if(!n){a(e.labIdMissingError);return}p(!0),a(null);try{const c=new Date().toISOString(),s=`I confirm completion of Web3Edu Lab
Lab ID: ${n}
Address: ${r}
Timestamp: ${c}`,i=await j({message:s});if(!(await fetch(`${l}/labs/complete`,{method:"POST",headers:{"Content-Type":"application/json","X-API-KEY":"1234567890DimtrisK240678Maria2806201809876543210"},body:JSON.stringify({address:r,labId:n,message:s,signature:i})})).ok)throw new Error("Backend rejected completion");b(!0),C(new Date().toISOString())}catch(c){console.error(c),a(e.backendError)}finally{p(!1)}}};return t.jsxs("div",{className:"mt-4",children:[x&&t.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:e.checkingStatus}),!u&&!x&&t.jsx("button",{onClick:y,disabled:m,className:`px-5 py-2 rounded-md font-semibold text-white transition ${m?"bg-slate-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:m?e.claimingButton:e.claimButton}),u&&t.jsxs("div",{className:"rounded-xl border border-green-300/60 dark:border-green-700/40 bg-green-50 dark:bg-green-900/20 p-4",children:[t.jsx("p",{className:"font-semibold text-green-700 dark:text-green-400",children:e.successMessage}),k&&t.jsxs("p",{className:"text-xs mt-1 text-green-600 dark:text-green-400",children:[e.completedOn," ",new Date(k).toLocaleString()]})]}),h&&t.jsx("p",{className:"mt-3 text-sm text-red-600 dark:text-red-400",children:h}),g&&t.jsx("a",{href:g,className:"inline-block mt-4 px-4 py-2 rounded-md bg-slate-700 text-white hover:bg-slate-800",children:E||e.backToOverview})]})}export{A as L};
