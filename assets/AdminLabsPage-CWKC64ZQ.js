import{u as w,j as e,r as u}from"./vendor-react-DaA--_H6.js";import{a as y}from"./adminApi-CSNMpv-F.js";import{u as C}from"./vendor-web3-B5M9rCAm.js";function M(s){return s>=.8?"text-green-600 dark:text-green-400":s>=.4?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}function F(s){return Math.max(0,(s.started||0)-(s.completed||0))}function L(s){if(typeof s?.completionRate=="number")return s.completionRate;const a=s?.started||0,l=s?.completed||0;return a<=0?0:l/a}function A(s){const a=s?.started||0,l=s?.completed||0;return a<=0?0:Math.max(0,(a-l)/a)}function N(s){const a=Number(s);return!Number.isFinite(a)||a<0?"—":`${Math.round(a)} min`}function D(s){return s>=5?"bg-red-50/70 dark:bg-red-900/20":s>=2?"bg-yellow-50/70 dark:bg-yellow-900/20":""}function S({labs:s}){const a=w();return!s||s.length===0?e.jsx("div",{className:"mt-8 text-slate-500 dark:text-slate-300",children:"No lab data available yet."}):e.jsxs("div",{className:"mt-10",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-slate-900 dark:text-slate-100",children:"Labs Progress"}),e.jsx("div",{className:"overflow-x-auto rounded-2xl border border-white/10 bg-white/60 dark:bg-[#0b0f17]/70 backdrop-blur-xl",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-white/80 dark:bg-[#111827]/80",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left text-slate-700 dark:text-slate-200",children:"Lab"}),e.jsx("th",{className:"p-3 text-left text-slate-700 dark:text-slate-200",children:"Category"}),e.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:"Started"}),e.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:"Completed"}),e.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:"Avg Time"}),e.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:"Median Time"}),e.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:"Drop‑off"}),e.jsx("th",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:"Completion"})]})}),e.jsx("tbody",{children:s.map(l=>{const x=F(l),m=l.started||0,o=l.completed||0,d=L(l),n=A(l),i=d>=.9?1:d>=.75?.8:.6,c=n>.15?"bg-rose-600":"bg-rose-500";return e.jsxs("tr",{onClick:()=>a(`/admin/labs/${l.labId}`),className:`cursor-pointer border-t border-white/10 hover:bg-white/60 dark:hover:bg-white/5 transition ${D(x)}`,children:[e.jsx("td",{className:"p-3 text-slate-900 dark:text-slate-100",children:l.title?.en||l.labId}),e.jsx("td",{className:"p-3 text-sm text-slate-600 dark:text-slate-400",children:l.category}),e.jsx("td",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:m}),e.jsx("td",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:o}),e.jsx("td",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:N(l.avgCompletionTimeMinutes)}),e.jsx("td",{className:"p-3 text-center text-slate-700 dark:text-slate-200",children:N(l.medianCompletionTimeMinutes)}),e.jsx("td",{className:"p-3 min-w-[220px]",children:e.jsxs("div",{className:"space-y-1 text-xs text-slate-600 dark:text-slate-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Started: ",m]}),e.jsxs("span",{children:["Completed: ",o]})]}),e.jsxs("div",{className:"h-2 w-full overflow-hidden rounded-full bg-slate-200 dark:bg-slate-800 flex",children:[e.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${Math.round(d*100)}%`,opacity:i}}),e.jsx("div",{className:`h-full ${c}`,style:{width:`${Math.round(n*100)}%`}})]}),e.jsxs("div",{className:"text-right font-medium",children:["Drop-off: ",Math.round(n*100),"%"]})]})}),e.jsxs("td",{className:`p-3 text-center font-semibold ${M(d)}`,children:[Math.round(d*100),"%"]})]},l.labId)})})]})})]})}function O(){const{address:s}=C(),[a,l]=u.useState(null),[x,m]=u.useState(null),[o,d]=u.useState("dropoff");if(u.useEffect(()=>{s&&y(s).then(t=>{Array.isArray(t)?l(t):t?.labs&&Array.isArray(t.labs)?l(t.labs):(console.log("Unexpected labs response shape:",t),l([]))}).catch(()=>m("Not authorized"))},[s]),x)return e.jsx("div",{className:"max-w-4xl rounded-2xl border border-red-500/30 bg-red-500/10 text-red-200 px-6 py-4",children:x});if(!a)return e.jsx("div",{className:"max-w-4xl rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl px-6 py-4 text-slate-700 dark:text-slate-200",children:"Loading lab analytics…"});const n=t=>{if(typeof t?.completionRate=="number")return t.completionRate;const r=t?.started||0,h=t?.completed||0;return r<=0?0:h/r},i=t=>{const r=t?.started||0,h=t?.completed||0;return r<=0?0:Math.max(0,(r-h)/r)},c=t=>{const r=Number(t?.avgCompletionTimeMinutes);return Number.isFinite(r)?r:-1},v=[...a].sort((t,r)=>o==="completion"?n(r)-n(t):o==="dropoff"?i(r)-i(t):o==="avgDuration"?c(r)-c(t):o==="started"?(r?.started||0)-(t?.started||0):0),b=a.length?[...a].sort((t,r)=>n(r)-n(t))[0]:null,g=a.length?[...a].sort((t,r)=>i(r)-i(t))[0]:null,j=a.length?[...a].sort((t,r)=>c(r)-c(t))[0]:null,k=t=>{const r=Number(t);return!Number.isFinite(r)||r<0?"—":`${Math.round(r)} min`},p=t=>t?.title?.en||t?.labId||"—";return e.jsxs("div",{className:"relative min-h-[calc(100vh-8rem)]",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[e.jsx("div",{className:"absolute -top-32 left-1/2 h-[420px] w-[420px] -translate-x-1/2 rounded-full bg-[#8A57FF]/25 blur-[140px]"}),e.jsx("div",{className:"absolute top-1/3 -right-24 h-[360px] w-[360px] rounded-full bg-[#4ACBFF]/20 blur-[140px]"}),e.jsx("div",{className:"absolute bottom-[-10%] left-[-8%] h-[320px] w-[320px] rounded-full bg-[#FF67D2]/15 blur-[130px]"})]}),e.jsxs("div",{className:"relative z-10 space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold tracking-tight bg-gradient-to-r from-[#FF67D2] via-[#8A57FF] to-[#4ACBFF] text-transparent bg-clip-text",children:"Labs Summary"}),e.jsx("p",{className:"text-base text-slate-600 dark:text-slate-300 mt-2",children:"Completion statistics and per-lab insights"})]}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/70 dark:bg-[#0b0f17]/80 backdrop-blur-xl shadow-[0_24px_70px_rgba(15,23,42,0.18)] p-6",children:[e.jsxs("div",{className:"mb-4 rounded-xl border border-yellow-400/50 bg-yellow-50/80 p-4 text-yellow-900 dark:border-yellow-600/40 dark:bg-yellow-950/30 dark:text-yellow-200",role:"alert",children:[e.jsx("strong",{className:"font-semibold",children:"Notice:"})," Lab start and completion are tracked separately. Drop-off reflects users who started but did not complete a lab."]}),e.jsxs("div",{className:"mb-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-200",children:"Sort by:"}),e.jsxs("select",{value:o,onChange:t=>d(t.target.value),className:"rounded-xl border border-slate-300/70 bg-white/90 px-3 py-2 text-sm text-slate-800 shadow-sm focus:outline-none focus:ring-2 focus:ring-fuchsia-400/40 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-100",children:[e.jsx("option",{value:"completion",children:"Completion %"}),e.jsx("option",{value:"dropoff",children:"Drop-off %"}),e.jsx("option",{value:"avgDuration",children:"Avg duration"}),e.jsx("option",{value:"started",children:"Total started"})]})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsx(f,{label:"Highest completion lab",title:p(b),value:`${Math.round(n(b)*100)}%`}),e.jsx(f,{label:"Worst drop-off lab",title:p(g),value:`${Math.round(i(g)*100)}%`}),e.jsx(f,{label:"Longest average duration lab",title:p(j),value:k(j?.avgCompletionTimeMinutes)})]}),e.jsx(S,{labs:v})]})]})]})}function f({label:s,title:a,value:l}){return e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/80 p-4 dark:bg-[#111827]/70",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:s}),e.jsx("p",{className:"mt-1 text-sm font-semibold text-slate-900 dark:text-slate-100",children:a}),e.jsx("p",{className:"mt-1 text-base font-bold text-fuchsia-700 dark:text-fuchsia-300",children:l})]})}export{O as default};
